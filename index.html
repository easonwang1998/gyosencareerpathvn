<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é­šé®®æœƒç¤¾ PT è·èƒ½å„€è¡¨æ¿</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #f0f2f5; padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 450px; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.08); }
        h2 { text-align: center; color: #1a73e8; margin-bottom: 25px; letter-spacing: 1px; }
        .search-box { margin-bottom: 30px; position: relative; }
        input { width: 100%; padding: 12px 15px; border: 2px solid #e1e4e8; border-radius: 12px; font-size: 16px; box-sizing: border-box; transition: border-color 0.3s; }
        input:focus { border-color: #1a73e8; outline: none; }
        .card { display: none; border-top: 1px solid #eee; padding-top: 25px; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .stat-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .label { color: #5f6368; font-size: 14px; }
        .value { font-weight: 600; color: #202124; font-size: 16px; }
        .badge { background: #ff9800; color: white; padding: 4px 12px; border-radius: 50px; font-size: 14px; }
        .progress-section { margin: 25px 0; }
        .progress-header { display: flex; justify-content: space-between; font-size: 13px; color: #5f6368; margin-bottom: 8px; }
        .progress-container { background: #e8eaed; border-radius: 10px; height: 20px; width: 100%; overflow: hidden; }
        .progress-bar { background: linear-gradient(90deg, #4285f4, #34a853); height: 100%; width: 0%; transition: width 0.8s ease-in-out; }
        .countdown { text-align: center; background: #fce8e6; color: #d93025; padding: 10px; border-radius: 8px; font-weight: bold; margin-top: 20px; }
        .footer-note { font-size: 12px; color: #9aa0a6; text-align: center; margin-top: 20px; line-height: 1.5; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ£ é­šé®®æœƒç¤¾ PT å„€è¡¨æ¿</h2>
    <div class="search-box">
        <input type="text" id="nameInput" placeholder="è¼¸å…¥æ‚¨çš„å§“åæŸ¥çœ‹é€²åº¦..." oninput="searchData()">
    </div>

    <div id="resultCard" class="card">
        <div class="stat-row">
            <span class="label">ç›®å‰è·ç´š</span>
            <span id="lvl" class="badge">--</span>
        </div>
        <div class="stat-row">
            <span class="label">ç”Ÿæ¶¯ç¸½ç´¯ç©æ™‚æ•¸</span>
            <span class="value"><span id="totalHrs">0</span> H</span>
        </div>
        
        <div class="progress-section">
            <div class="progress-header">
                <span>æœ¬è·ç´šè€ƒæ ¸é€²åº¦</span>
                <span id="percentText">0%</span>
            </div>
            <div class="progress-container">
                <div id="pBar" class="progress-bar"></div>
            </div>
        </div>

        <div id="diffText" class="countdown"></div>
        
        <div class="footer-note">
            è³‡æ–™æ¯ 5-10 åˆ†é˜è‡ªå‹•åŒæ­¥<br>
            è‹¥æ•¸æ“šæœ‰èª¤è«‹æ´½åº—é‹ªä¸»ç®¡
        </div>
    </div>
</div>

<script>
    // ã€é‡è¦ã€‘è«‹å‹™å¿…å°‡ä¸‹æ–¹çš„ç¶²å€æ›¿æ›ç‚ºä½  Google è©¦ç®—è¡¨ç™¼ä½ˆçš„ CSV ç¶²å€
    const csvUrl = 'ä½ çš„GOOGLEè©¦ç®—è¡¨CSVç™¼ä½ˆç¶²å€';

    let ptData = [];

    // ä½¿ç”¨ PapaParse è®€å– CSV
    Papa.parse(csvUrl, {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: function(results) {
            ptData = results.data;
            console.log("è³‡æ–™åŠ è¼‰æˆåŠŸ", ptData);
        }
    });

    function searchData() {
        const name = document.getElementById('nameInput').value.trim();
        const card = document.getElementById('resultCard');
        
        // æœå°‹å“¡å·¥ï¼Œæ’é™¤ç©ºç™½åˆ—ä¸¦è™•ç†å‰å¾Œç©ºæ ¼
        const user = ptData.find(row => row["å§“å"] && row["å§“å"].trim() === name);

        if (user && name !== "") {
            card.style.display = 'block';
            
            // æŠ“å–å„æ¬„ä½æ•¸å€¼
            const lvl = user["ç­‰ç´š"] || "L1";
            const total = parseFloat(user["ä¸Šç­æ™‚æ•¸"]) || 0;
            const base = parseFloat(user["æ™‰å‡æ™‚ç¸½æ™‚æ•¸"]) || 0;
            const target = parseFloat(user["ä¸‹æ¬¡è€ƒæ ¸é–€æª»"]) || 0;
            const currentPeriod = parseFloat(user["æœ¬è·ç´šç´¯ç©æ™‚æ•¸"]) || (total - base);

            // æ›´æ–°ç•«é¢
            document.getElementById('lvl').innerText = lvl;
            document.getElementById('totalHrs').innerText = total;

            // è¨ˆç®—é€²åº¦
            const goal = target - base;
            let percent = 0;
            if (goal > 0) {
                percent = Math.min(Math.round((currentPeriod / goal) * 100), 100);
            }
            
            // æ›´æ–°é€²åº¦æ¢
            document.getElementById('pBar').style.width = percent + '%';
            document.getElementById('percentText').innerText = percent + '%';
            
            // æ›´æ–°å€’æ•¸æ–‡å­—
            const remain = Math.max(0, target - total);
            if (remain <= 0) {
                document.getElementById('diffText').innerText = "âœ¨ å·²é”è€ƒæ ¸é–€æª»ï¼";
                document.getElementById('diffText').style.background = "#e6f4ea";
                document.getElementById('diffText').style.color = "#1e8e3e";
            } else {
                document.getElementById('diffText').innerText = "è·é›¢ä¸‹éšæ®µè€ƒæ ¸é‚„å·® " + remain + " å°æ™‚";
                document.getElementById('diffText').style.background = "#fce8e6";
                document.getElementById('diffText').style.color = "#d93025";
            }
        } else {
            card.style.display = 'none';
        }
    }
</script>

</body>
</html>
